# ระบบควบคุมงบประมาณโครงการ (Project Budget Control System)

ระบบควบคุมงบประมาณโครงการ เป็นแอปพลิเคชันสำหรับบริหารจัดการงบประมาณของโครงการต่างๆ ภายในองค์กร โดยมีฟังก์ชันการทำงานที่ครอบคลุมการบริหารจัดการงบประมาณอย่างครบถ้วน

## ฟังก์ชันการทำงานหลัก

### 1. การจัดการโครงการ (Project Management)
- สร้างโครงการใหม่
- กำหนดรายละเอียดโครงการ:
  - ชื่อโครงการ
  - ผู้รับผิดชอบ
  - งบประมาณรวม
  - หมวดงบประมาณ (เงินอุดหนุนรายหัว, เงินพัฒนาผู้เรียน, ฯลฯ)
  - กลุ่มงาน (วิชาการ, งบประมาณ, บุคลากร, บริหารทั่วไป, อื่นๆ)
  - วันที่เริ่มต้นและสิ้นสุดโครงการ
  - สถานะโครงการ (กำลังดำเนินการ, เสร็จสิ้น)
  - รายละเอียดโครงการ
- แก้ไขข้อมูลโครงการ
- ดูรายละเอียดโครงการ
- นำเข้าโครงการจากไฟล์ Excel
- ส่งออกข้อมูลโครงการเป็นไฟล์ Excel

### 2. การบริหารงบประมาณ (Budget Management)
- บันทึกรายการใช้จ่ายงบประมาณ
- แสดงยอดงบประมาณคงเหลือแยกตามหมวด
- คำนวณงบประมาณอัตโนมัติ:
  - งบประมาณทั้งหมด
  - ยอดใช้จ่าย
  - งบประมาณคงเหลือ
  - เปอร์เซ็นต์การใช้งบประมาณ
- โอนงบประมาณระหว่างโครงการ:
  - โอนระหว่างหมวดงบประมาณเดียวกัน
  - โอนระหว่างหมวดงบประมาณต่างกัน
  - บันทึกประวัติการโอนอัตโนมัติ
  - แสดงการแจ้งเตือนเมื่อโอนต่างหมวด

### 3. การแสดงผลข้อมูล (Data Display)
- แสดงภาพรวมงบประมาณทั้งหมด
- แสดงรายละเอียดการใช้จ่ายแยกตามโครงการ
- แสดงรายละเอียดแยกตามหมวดงบประมาณ
- แสดงประวัติการทำรายการ:
  - รายการใช้จ่าย
  - การโอนงบประมาณ
- แสดงสถานะโครงการ
- Progress bar แสดงความคืบหน้าการใช้งบประมาณ

### 4. การกรองและค้นหาข้อมูล (Filtering)
- กรองตามกลุ่มงาน
- กรองตามสถานะโครงการ
- กรองตามหมวดงบประมาณ
- ค้นหาโครงการ
- กรองตามช่วงเวลา

### 5. การอัพเดทแบบ Real-time
- อัพเดทยอดงบประมาณทันทีเมื่อมีการทำรายการ
- แสดงการแจ้งเตือนเมื่อทำรายการสำเร็จ
- อัพเดทสถานะโครงการอัตโนมัติ

### 6. การตรวจสอบความถูกต้อง (Validation)
- ตรวจสอบยอดงบประมาณคงเหลือก่อนทำรายการ
- ตรวจสอบความถูกต้องของข้อมูลที่กรอก
- แจ้งเตือนเมื่อข้อมูลไม่ถูกต้อง
- ป้องกันการทำรายการที่เกินงบประมาณ

## การติดตั้งและใช้งาน

### การติดตั้ง
1. ติดตั้ง Node.js (เวอร์ชัน 14.0.0 ขึ้นไป)
2. Clone โปรเจค
3. ติดตั้ง dependencies:
   ```bash
   npm install
   ```
4. รันแอปพลิเคชัน:
   ```bash
   npm start
   ```
5. เปิดเบราว์เซอร์ที่ http://localhost:3000

### เทคโนโลยีที่ใช้
- React
- TypeScript
- Material-UI
- React Router
- Date-fns
- xlsx
- React Context API (สำหรับการจัดการ state แบบเรียลไทม์)

### โครงสร้างโปรเจค
```
budget-control/
├── README.md
├── src/
│   ├── components/     # React components
│   ├── context/       # React Context providers
│   ├── types/         # TypeScript Interfaces
│   ├── utils/         # Utility Functions
│   ├── App.tsx        # Main application component
│   └── main.tsx       # Application entry point
├── public/            # Static files
├── templates/         # Excel templates
│   └── project_export_template.xlsx
└── scripts/          # Utility scripts
    └── create_excel_template.py
```

## การนำเข้าข้อมูลจาก Excel

### 1. การเตรียมไฟล์ Excel
1. ดาวน์โหลดไฟล์เทมเพลต Excel จากระบบโดยคลิกที่ปุ่ม "ส่งออกโครงการ" บนหน้าจัดการโครงการ
2. ไฟล์ Excel ประกอบด้วยชีทต่างๆ ดังนี้:
   - Sheet "นำเข้าโครงการ" หรือ "โครงการทั้งหมด": สำหรับข้อมูลโครงการ
   - Sheet "รายการทั้งหมด": สำหรับข้อมูลรายการเบิกจ่ายและการโอนงบประมาณ
   - Sheet "แบบฟอร์มโครงการ": ตัวอย่างการกรอกข้อมูลโครงการ
   - Sheet "แบบฟอร์มรายการ": ตัวอย่างการกรอกข้อมูลรายการปกติ
   - Sheet "แบบฟอร์มโอนงบ": ตัวอย่างการกรอกข้อมูลรายการโอนงบประมาณ
   - Sheet "คำอธิบายโครงการ" และ "คำอธิบายรายการ": คำอธิบายฟิลด์ต่างๆ

### 2. การกรอกข้อมูลโครงการ
#### ข้อมูลที่จำเป็น:
- `name`: ชื่อโครงการ
- `responsiblePerson`: ผู้รับผิดชอบโครงการ
- `budget`: งบประมาณรวม (ตัวเลขเท่านั้น)
- `workGroup`: กลุ่มงาน (เลือกจาก: academic, budget, hr, general, other)
- `startDate`: วันที่เริ่มต้น (รูปแบบ: YYYY-MM-DD)
- `endDate`: วันที่สิ้นสุด (รูปแบบ: YYYY-MM-DD)
- `status`: สถานะโครงการ (เลือกจาก: active, completed หรือ ดำเนินการ, เสร็จสิ้น)
- `description`: รายละเอียดโครงการ (ไม่บังคับ)

#### หมวดงบประมาณ:
- `budgetCategories`: กรอกในรูปแบบ JSON array
  ```json
  [
    {"category": "SUBSIDY", "amount": 100000, "description": "เงินอุดหนุนรายหัว"},
    {"category": "DEVELOPMENT", "amount": 50000, "description": "เงินพัฒนาผู้เรียน"}
  ]
  ```
- หมวดที่รองรับ (ใช้ key เป็นภาษาอังกฤษในการนำเข้า):
  - SUBSIDY: เงินอุดหนุนรายหัว
  - DEVELOPMENT: เงินพัฒนาผู้เรียน
  - INCOME: เงินรายได้สถานศึกษา
  - EQUIPMENT: เงินค่าอุปกรณ์การเรียน
  - UNIFORM: เงินค่าเครื่องแบบ
  - BOOKS: เงินค่าหนังสือ
  - LUNCH: เงินอาหารกลางวัน

### 3. การกรอกข้อมูลรายการธุรกรรม
#### ข้อมูลที่จำเป็น:
- `projectName`: ชื่อโครงการที่เกี่ยวข้อง (ต้องตรงกับชื่อในระบบ)
- `date`: วันที่ทำรายการ (รูปแบบ: YYYY-MM-DD)
- `description`: รายละเอียดรายการ
- `amount`: จำนวนเงิน (ตัวเลขเท่านั้น เป็นค่าบวก)
- `budgetCategory`: หมวดงบประมาณ (ใช้ key เช่น SUBSIDY, DEVELOPMENT เป็นต้น)
- `note`: หมายเหตุ (ไม่บังคับ)

#### รายการโอนเงิน:
สำหรับการนำเข้ารายการโอนงบประมาณ สามารถทำได้ 2 วิธี:

**วิธีที่ 1: นำเข้าทั้งรายการต้นทางและปลายทาง (แนะนำ)**
1. สร้างรายการโอนออก:
```
projectName: โครงการต้นทาง
date: 2024-04-01
description: [โอนงบประมาณ] โอนไปยังโครงการ: โครงการปลายทาง (เงินอุดหนุนรายหัว)
amount: 10000
budgetCategory: SUBSIDY
note: หมายเหตุเพิ่มเติม (ถ้ามี)
isTransfer: true
isTransferIn: false
transferToProjectName: โครงการปลายทาง
transferToCategory: SUBSIDY
```

2. สร้างรายการรับโอน:
```
projectName: โครงการปลายทาง
date: 2024-04-01
description: [โอนงบประมาณ] รับจากโครงการ: โครงการต้นทาง (เงินอุดหนุนรายหัว)
amount: 10000
budgetCategory: SUBSIDY
note: หมายเหตุเพิ่มเติม (ถ้ามี)
isTransfer: true
isTransferIn: true
transferFromProjectName: โครงการต้นทาง
transferFromCategory: SUBSIDY
```

**วิธีที่ 2: นำเข้าเฉพาะรายการต้นทางหรือปลายทาง**
- ระบบจะสร้างคู่รายการโอนให้อัตโนมัติ
- ต้องระบุ `isTransfer: true` และ `isTransferIn: true/false` ให้ถูกต้อง
- ระบุ `transferToProjectName`/`transferFromProjectName` และ `transferToCategory`/`transferFromCategory` ให้ครบถ้วน

### 4. การตรวจจับรายการซ้ำ
ระบบได้รับการปรับปรุงให้สามารถตรวจจับรายการซ้ำได้อย่างมีประสิทธิภาพมากขึ้น:

1. ตรวจจับรายการปกติซ้ำ:
   - ตรวจสอบจากโครงการ, วันที่, รายละเอียด, จำนวนเงิน และหมวดงบประมาณ

2. ตรวจจับรายการโอนงบประมาณซ้ำ:
   - ตรวจสอบคู่โครงการต้นทาง-ปลายทาง, วันที่, จำนวนเงิน และหมวดงบประมาณ
   - ตรวจสอบทั้งรายการโอนออกและรายการรับโอน
   - ตรวจจับรายการโอนซ้ำในไฟล์นำเข้า (กรณีมีทั้งต้นทางและปลายทาง)

### 5. ขั้นตอนการนำเข้าข้อมูล
1. เตรียมไฟล์ Excel ตามรูปแบบที่กำหนด
2. ตรวจสอบความถูกต้องของข้อมูล
3. ไปที่หน้า "จัดการโครงการ"
4. คลิกที่ปุ่ม "นำเข้าโครงการจาก Excel"
5. เลือกไฟล์ Excel ที่เตรียมไว้
6. ระบบจะแสดงผลลัพธ์การนำเข้า พร้อมระบุจำนวนรายการที่นำเข้าสำเร็จและรายการที่ถูกข้าม

## การแก้ไขปัญหาเบื้องต้น

### ปัญหาการนำเข้ารายการโอนงบประมาณ
1. **รายการโอนงบประมาณซ้ำกันในระบบ**
   - ตรวจสอบว่าไฟล์นำเข้ามีทั้งรายการโอนออกและรับโอนหรือไม่
   - ระบบอาจสร้างรายการซ้ำกับที่มีอยู่แล้ว หากรายการไม่เหมือนกันทุกประการ
   - แนะนำให้นำเข้าทั้งรายการโอนออกและรับโอนพร้อมกัน

2. **รายการโอนงบประมาณไม่ถูกนำเข้า**
   - ตรวจสอบว่ารูปแบบคำอธิบายรายการถูกต้อง (`[โอนงบประมาณ]` ต้องอยู่ที่ต้นข้อความ)
   - ตรวจสอบว่าฟิลด์ `isTransfer` เป็น `true`
   - ตรวจสอบว่าชื่อโครงการต้นทางและปลายทางตรงกับในระบบ

3. **ยอดงบประมาณไม่ถูกต้องหลังการนำเข้า**
   - ตรวจสอบว่ามีการนำเข้ารายการโอนงบประมาณครบทั้งคู่
   - ตรวจสอบการกำหนดหมวดงบประมาณต้นทางและปลายทาง
   - ตรวจสอบว่าค่า `isTransferIn` ถูกกำหนดอย่างถูกต้อง

### ปัญหาหมวดงบประมาณ
1. **หมวดงบประมาณไม่ถูกต้อง**
   - ตรวจสอบว่าใช้ key ภาษาอังกฤษ (เช่น SUBSIDY, DEVELOPMENT) ไม่ใช่ค่าภาษาไทย
   - รหัสหมวดงบประมาณต้องตรงกับที่กำหนดในระบบ
   - กรณีนำเข้าเป็นชื่อภาษาไทย ระบบจะพยายามแปลงเป็น key ให้อัตโนมัติ

2. **ยอดเงินในหมวดงบประมาณไม่ตรงกับงบประมาณรวม**
   - ตรวจสอบผลรวมของเงินในแต่ละหมวดงบประมาณ
   - ระบบจะใช้ผลรวมของเงินในแต่ละหมวดเป็นงบประมาณรวมโดยอัตโนมัติ

## อัพเดทล่าสุด
- ปรับปรุงระบบการนำเข้าข้อมูลจาก Excel
- เพิ่มการตรวจจับรายการโอนงบประมาณซ้ำอย่างอัตโนมัติ
- ปรับปรุงการแสดงผลข้อมูลการนำเข้าให้ละเอียดมากขึ้น
- แก้ไขปัญหาการนำเข้ารายการโอนงบประมาณที่อาจเกิดรายการซ้ำ
- ปรับปรุงการแสดงผลรายการธุรกรรมในตารางให้อ่านง่ายขึ้น

## การอัพเดทในอนาคต
- [ ] เพิ่มระบบ Export รายงาน
- [ ] เพิ่มการแสดงกราฟวิเคราะห์งบประมาณ
- [ ] เพิ่มระบบจัดการผู้ใช้และสิทธิ์
- [ ] เพิ่มระบบแจ้งเตือนเมื่องบประมาณใกล้หมด
- [ ] เพิ่มระบบสำรองข้อมูลอัตโนมัติ
